
# Exploitation for Privilege Escalation

## Description

### MITRE Description

> Adversaries may exploit software vulnerabilities in an attempt to collect elevate privileges. Exploitation of a software vulnerability occurs when an adversary takes advantage of a programming error in a program, service, or within the operating system software or kernel itself to execute adversary-controlled code. Security constructs such as permission levels will often hinder access to information and use of certain techniques, so adversaries will likely need to perform privilege escalation to include use of software exploitation to circumvent those restrictions.

When initially gaining access to a system, an adversary may be operating within a lower privileged process which will prevent them from accessing certain resources on the system. Vulnerabilities may exist, usually in operating system components and software commonly running at higher permissions, that can be exploited to gain higher levels of access on the system. This could enable someone to move from unprivileged or user level permissions to SYSTEM or root permissions depending on the component that is vulnerable. This may be a necessary step for an adversary compromising a endpoint system that has been properly configured and limits other privilege escalation methods.

## Aliases

```

```

## Additional Attributes

* Bypass: None
* Effective Permissions: ['User']
* Network: None
* Permissions: ['User']
* Platforms: ['Linux', 'macOS', 'Windows']
* Remote: None
* Type: attack-pattern
* Wiki: https://attack.mitre.org/techniques/T1068

## Potential Commands

```
getsystem
bitsadmin.exe
msbuild.exe *MSBuildShell.csproj
powershell/privesc/ms16-032
powershell/privesc/tater
powershell/privesc/ms16-135
```

## Commands Dataset

```
[{'command': 'getsystem',
  'name': 'Cobalt Strike',
  'source': 'https://attack.mitre.org/docs/APT3_Adversary_Emulation_Field_Manual.xlsx'},
 {'command': 'getsystem',
  'name': 'Metasploit',
  'source': 'https://attack.mitre.org/docs/APT3_Adversary_Emulation_Field_Manual.xlsx'},
 {'command': 'bitsadmin.exe',
  'name': 'parent_process',
  'source': 'Threat Hunting Tables'},
 {'command': 'msbuild.exe *MSBuildShell.csproj',
  'name': None,
  'source': 'Threat Hunting Tables'},
 {'command': 'powershell/privesc/ms16-032',
  'name': 'Empire Module Command',
  'source': 'https://github.com/dstepanic/attck_empire/blob/master/Empire_modules.xlsx?raw=true'},
 {'command': 'powershell/privesc/ms16-032',
  'name': 'Empire Module Command',
  'source': 'https://github.com/dstepanic/attck_empire/blob/master/Empire_modules.xlsx?raw=true'},
 {'command': 'powershell/privesc/tater',
  'name': 'Empire Module Command',
  'source': 'https://github.com/dstepanic/attck_empire/blob/master/Empire_modules.xlsx?raw=true'},
 {'command': 'powershell/privesc/tater',
  'name': 'Empire Module Command',
  'source': 'https://github.com/dstepanic/attck_empire/blob/master/Empire_modules.xlsx?raw=true'},
 {'command': 'powershell/privesc/ms16-135',
  'name': 'Empire Module Command',
  'source': 'https://github.com/dstepanic/attck_empire/blob/master/Empire_modules.xlsx?raw=true'},
 {'command': 'powershell/privesc/ms16-135',
  'name': 'Empire Module Command',
  'source': 'https://github.com/dstepanic/attck_empire/blob/master/Empire_modules.xlsx?raw=true'}]
```

## Potential Detections

```json
[{'data_source': {'author': 'Florian Roth',
                  'description': 'Detects Hurricane Panda Activity',
                  'detection': {'condition': 'selection',
                                'selection': {'CommandLine': ['* localgroup '
                                                              'administrators '
                                                              'admin /add',
                                                              '*\\Win64.exe*']}},
                  'falsepositives': ['Unknown'],
                  'id': '0eb2107b-a596-422e-b123-b389d5594ed7',
                  'level': 'high',
                  'logsource': {'category': 'process_creation',
                                'product': 'windows'},
                  'references': ['https://www.crowdstrike.com/blog/crowdstrike-discovers-use-64-bit-zero-day-privilege-escalation-exploit-cve-2014-4113-hurricane-panda/'],
                  'status': 'experimental',
                  'tags': ['attack.privilege_escalation',
                           'attack.g0009',
                           'attack.t1068'],
                  'title': 'Hurricane Panda Activity'}},
 {'data_source': {'author': 'Patrick Bareiss',
                  'date': '2019/04/05',
                  'description': 'Detects suspicious shell commands indicating '
                                 'the information gathering phase as '
                                 'preparation for the Privilege Escalation.',
                  'detection': {'condition': 'keywords | count() by host > 6',
                                'keywords': ['cat /etc/issue',
                                             'cat /etc/*-release',
                                             'cat /proc/version',
                                             'uname -a',
                                             'uname -mrs',
                                             'rpm -q kernel',
                                             'dmesg | grep Linux',
                                             'ls /boot | grep vmlinuz-',
                                             'cat /etc/profile',
                                             'cat /etc/bashrc',
                                             'cat ~/.bash_profile',
                                             'cat ~/.bashrc',
                                             'cat ~/.bash_logout',
                                             'ps -aux | grep root',
                                             'ps -ef | grep root',
                                             'crontab -l',
                                             'cat /etc/cron*',
                                             'cat /etc/cron.allow',
                                             'cat /etc/cron.deny',
                                             'cat /etc/crontab',
                                             'grep -i user *',
                                             'grep -i pass *',
                                             'ifconfig',
                                             'cat /etc/network/interfaces',
                                             'cat /etc/sysconfig/network',
                                             'cat /etc/resolv.conf',
                                             'cat /etc/networks',
                                             'iptables -L',
                                             'lsof -i',
                                             'netstat -antup',
                                             'netstat -antpx',
                                             'netstat -tulpn',
                                             'arp -e',
                                             'route',
                                             'cat /etc/passwd',
                                             'cat /etc/group',
                                             'cat /etc/shadow',
                                             'find / -perm -u=s',
                                             'find / -perm -g=s',
                                             'find / -perm -4000',
                                             'find / -perm -2000'],
                                'timeframe': '30m'},
                  'falsepositives': ['Troubleshooting on Linux Machines'],
                  'id': '444ade84-c362-4260-b1f3-e45e20e1a905',
                  'level': 'medium',
                  'logsource': {'product': 'linux'},
                  'references': ['https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/',
                                 'https://patrick-bareiss.com/detect-privilege-escalation-preparation-in-linux-with-sigma/'],
                  'status': 'experimental',
                  'tags': ['attack.privilege_escalation', 'attack.t1068'],
                  'title': 'Privilege Escalation Preparation'}},
 {'data_source': {'author': 'Florian Roth',
                  'date': '2019/11/20',
                  'description': 'Detects an explotation attempt in which the '
                                 'UAC consent dialogue is used to invoke an '
                                 'Internet Explorer process running as '
                                 'LOCAL_SYSTEM',
                  'detection': {'condition': 'selection and ( rights1 or '
                                             'rights2 )',
                                'rights1': {'IntegrityLevel': 'System'},
                                'rights2': {'User': 'NT AUTHORITY\\SYSTEM'},
                                'selection': {'CommandLine': '* http*',
                                              'Image': '*\\iexplore.exe',
                                              'ParentImage': '*\\consent.exe'}},
                  'falsepositives': ['Unknown'],
                  'id': '02e0b2ea-a597-428e-b04a-af6a1a403e5c',
                  'level': 'critical',
                  'logsource': {'category': 'process_creation',
                                'product': 'windows'},
                  'references': ['https://www.zerodayinitiative.com/blog/2019/11/19/thanksgiving-treat-easy-as-pie-windows-7-secure-desktop-escalation-of-privilege'],
                  'status': 'experimental',
                  'tags': ['attack.privilege_escalation', 'attack.t1068'],
                  'title': 'Exploiting CVE-2019-1388'}},
 {'data_source': {'author': 'Teymur Kheirkhabarov (source), Daniil '
                            'Yugoslavskiy (rule)',
                  'date': '2019/06/03',
                  'description': 'Detection of child processes spawned with '
                                 'SYSTEM privileges by parents with non-SYSTEM '
                                 'privileges and Medium integrity level',
                  'detection': {'condition': 'selection',
                                'selection': {'IntegrityLevel': 'System',
                                              'ParentIntegrityLevel': 'Medium',
                                              'User': 'NT AUTHORITY\\SYSTEM'}},
                  'enrichment': ['EN_0001_cache_sysmon_event_id_1_info',
                                 'EN_0002_enrich_sysmon_event_id_1_with_parent_info'],
                  'falsepositives': ['Unknown'],
                  'id': '8065b1b4-1778-4427-877f-6bf948b26d38',
                  'level': 'critical',
                  'logsource': {'category': 'process_creation',
                                'product': 'windows'},
                  'references': ['https://www.slideshare.net/heirhabarov/hunting-for-privilege-escalation-in-windows-environment'],
                  'status': 'experimental',
                  'tags': ['attack.privilege_escalation', 'attack.t1068'],
                  'title': 'Windows Kernel and 3rd-party drivers exploits. '
                           'Token stealing'}},
 {'data_source': ['1000', ' 1001', 'Windows Error Reporting']},
 {'data_source': ['4688', 'Process Execution']},
 {'data_source': ['Application Logs']},
 {'data_source': ['1000', ' 1001', 'Windows Error Reporting']},
 {'data_source': ['4688', 'Process Execution']},
 {'data_source': ['Application Logs']}]
```

## Potential Queries

```json

```

## Raw Dataset

```json
[{'Mitre APT3 Adversary Emulation Field Manual': {'Built-in Windows Command': '',
                                                  'Category': 'T1068',
                                                  'Cobalt Strike': 'getsystem',
                                                  'Description': 'This '
                                                                 'technique '
                                                                 'tries a '
                                                                 'series of '
                                                                 'exploits to '
                                                                 'elevate to a '
                                                                 'SYSTEM level '
                                                                 'process '
                                                                 '(these are '
                                                                 'actual '
                                                                 'exploits, '
                                                                 'not trust '
                                                                 'abuses, so '
                                                                 "there's "
                                                                 'always the '
                                                                 'potential '
                                                                 'for '
                                                                 'bluescreening)',
                                                  'Metasploit': 'getsystem'}},
 {'Threat Hunting Tables': {'chain_id': '100013',
                            'commandline_string': '',
                            'file_path': '',
                            'file_value': '',
                            'frequency': 'low',
                            'itw_sample': 'https://www.joesecurity.org/reports/report-1144eeaebb15044fa64f4d9bb5670349.html#startup',
                            'loaded_dll': '',
                            'mitre_attack': 'T1068',
                            'mitre_caption': 'file_transfer',
                            'os': 'windows',
                            'parent_process': 'bitsadmin.exe',
                            'registry_path': '',
                            'registry_value': '',
                            'sub_process_1': '',
                            'sub_process_2': ''}},
 {'Threat Hunting Tables': {'chain_id': '100041',
                            'commandline_string': '*MSBuildShell.csproj',
                            'file_path': '',
                            'file_value': '',
                            'frequency': 'rare',
                            'itw_sample': 'https://github.com/Cn33liz/MSBuildShell/blob/master/MSBuildShell.csproj',
                            'loaded_dll': '',
                            'mitre_attack': 'T1068',
                            'mitre_caption': 'vulnerability_exploit',
                            'os': 'windows',
                            'parent_process': 'msbuild.exe',
                            'registry_path': '',
                            'registry_value': '',
                            'sub_process_1': '',
                            'sub_process_2': ''}},
 {'Empire Module XLSX Sheet by dstepanic': {'ATT&CK Technique #1': 'T1068',
                                            'ATT&CK Technique #2': '',
                                            'Concatenate for Python Dictionary': '"powershell/privesc/ms16-032":  '
                                                                                 '["T1068"],',
                                            'Empire Module': 'powershell/privesc/ms16-032',
                                            'Technique': 'Exploitation for '
                                                         'Privilege '
                                                         'Escalation'}},
 {'Empire Module XLSX Sheet by dstepanic': {'ATT&CK Technique #1': 'T1068',
                                            'ATT&CK Technique #2': '',
                                            'Concatenate for Python Dictionary': '"powershell/privesc/tater":  '
                                                                                 '["T1068"],',
                                            'Empire Module': 'powershell/privesc/tater',
                                            'Technique': 'Exploitation for '
                                                         'Privilege '
                                                         'Escalation'}},
 {'Empire Module XLSX Sheet by dstepanic': {'ATT&CK Technique #1': 'T1068',
                                            'ATT&CK Technique #2': '',
                                            'Concatenate for Python Dictionary': '"powershell/privesc/ms16-135":  '
                                                                                 '["T1068"],',
                                            'Empire Module': 'powershell/privesc/ms16-135',
                                            'Technique': 'Exploitation for '
                                                         'Privilege '
                                                         'Escalation'}}]
```

# Tactics


* [Privilege Escalation](../tactics/Privilege-Escalation.md)


# Mitigations


* [Exploitation for Privilege Escalation Mitigation](../mitigations/Exploitation-for-Privilege-Escalation-Mitigation.md)

* [Update Software](../mitigations/Update-Software.md)
    
* [Threat Intelligence Program](../mitigations/Threat-Intelligence-Program.md)
    
* [Exploit Protection](../mitigations/Exploit-Protection.md)
    
* [Application Isolation and Sandboxing](../mitigations/Application-Isolation-and-Sandboxing.md)
    

# Actors


* [PLATINUM](../actors/PLATINUM.md)

* [APT32](../actors/APT32.md)
    
* [FIN6](../actors/FIN6.md)
    
* [APT28](../actors/APT28.md)
    
* [Cobalt Group](../actors/Cobalt-Group.md)
    
* [Threat Group-3390](../actors/Threat-Group-3390.md)
    
* [FIN8](../actors/FIN8.md)
    
* [APT33](../actors/APT33.md)
    
* [Whitefly](../actors/Whitefly.md)
    
