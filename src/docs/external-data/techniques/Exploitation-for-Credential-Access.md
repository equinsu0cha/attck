
# Exploitation for Credential Access

## Description

### MITRE Description

> Adversaries may exploit software vulnerabilities in an attempt to collect credentials. Exploitation of a software vulnerability occurs when an adversary takes advantage of a programming error in a program, service, or within the operating system software or kernel itself to execute adversary-controlled code.Â Credentialing and authentication mechanisms may be targeted for exploitation by adversaries as a means to gain access to useful credentials or circumvent the process to gain access to systems. One example of this is MS14-068, which targets Kerberos and can be used to forge Kerberos tickets using domain user permissions.(Citation: Technet MS14-068)(Citation: ADSecurity Detecting Forged Tickets) Exploitation for credential access may also result in Privilege Escalation depending on the process targeted or credentials obtained.

## Aliases

```

```

## Additional Attributes

* Bypass: None
* Effective Permissions: None
* Network: None
* Permissions: ['User']
* Platforms: ['Linux', 'Windows', 'macOS']
* Remote: None
* Type: attack-pattern
* Wiki: https://attack.mitre.org/techniques/T1212

## Potential Commands

```

```

## Commands Dataset

```

```

## Potential Detections

```json
[{'data_source': {'action': 'global',
                  'author': 'Florian Roth',
                  'date': '2018/03/20',
                  'description': 'Detects post exploitation using NetNTLM '
                                 'downgrade attacks',
                  'detection': {'condition': '1 of them'},
                  'falsepositives': ['Unknown'],
                  'id': 'd67572a0-e2ec-45d6-b8db-c100d14b8ef2',
                  'level': 'critical',
                  'references': ['https://www.optiv.com/blog/post-exploitation-using-netntlm-downgrade-attacks'],
                  'tags': ['attack.credential_access', 'attack.t1212'],
                  'title': 'NetNTLM Downgrade Attack'}},
 {'data_source': {'detection': {'selection1': {'EventID': 13,
                                               'TargetObject': ['*SYSTEM\\\\*ControlSet*\\Control\\Lsa\\lmcompatibilitylevel',
                                                                '*SYSTEM\\\\*ControlSet*\\Control\\Lsa\\NtlmMinClientSec',
                                                                '*SYSTEM\\\\*ControlSet*\\Control\\Lsa\\RestrictSendingNTLMTraffic']}},
                  'logsource': {'product': 'windows', 'service': 'sysmon'}}},
 {'data_source': {'detection': {'selection2': {'EventID': 4657,
                                               'ObjectName': '\\REGISTRY\\MACHINE\\SYSTEM\\\\*ControlSet*\\Control\\Lsa',
                                               'ObjectValueName': ['LmCompatibilityLevel',
                                                                   'NtlmMinClientSec',
                                                                   'RestrictSendingNTLMTraffic']}},
                  'logsource': {'definition': 'Requirements: Audit Policy : '
                                              'Object Access > Audit Registry '
                                              '(Success)',
                                'product': 'windows',
                                'service': 'security'}}},
 {'data_source': {'author': 'Florian Roth',
                  'description': 'This method triggers on rare Kerberos '
                                 'Failure Codes caused by manipulations of '
                                 'Kerberos messages',
                  'detection': {'condition': 'selection',
                                'selection': {'EventID': [675,
                                                          4768,
                                                          4769,
                                                          4771],
                                              'FailureCode': ['0x9',
                                                              '0xA',
                                                              '0xB',
                                                              '0xF',
                                                              '0x10',
                                                              '0x11',
                                                              '0x13',
                                                              '0x14',
                                                              '0x1A',
                                                              '0x1F',
                                                              '0x21',
                                                              '0x22',
                                                              '0x23',
                                                              '0x24',
                                                              '0x26',
                                                              '0x27',
                                                              '0x28',
                                                              '0x29',
                                                              '0x2C',
                                                              '0x2D',
                                                              '0x2E',
                                                              '0x2F',
                                                              '0x31',
                                                              '0x32',
                                                              '0x3E',
                                                              '0x3F',
                                                              '0x40',
                                                              '0x41',
                                                              '0x43',
                                                              '0x44']}},
                  'falsepositives': ['Faulty legacy applications'],
                  'id': 'f7644214-0eb0-4ace-9455-331ec4c09253',
                  'level': 'high',
                  'logsource': {'product': 'windows', 'service': 'security'},
                  'tags': ['attack.credential_access', 'attack.t1212'],
                  'title': 'Kerberos Manipulation'}},
 {'data_source': {'author': 'Dimitrios Slamaris',
                  'description': 'Detects a possible remote NTLM hash change '
                                 'through SAMR API SamiChangePasswordUser() or '
                                 'SamSetInformationUser(). "Audit User Account '
                                 'Management" in "Advanced Audit Policy '
                                 'Configuration" has to be enabled in your '
                                 'local security policy / GPO to see this '
                                 'events.',
                  'detection': {'condition': '( passwordchanged and not '
                                             'passwordchanged_filter ) | near '
                                             'samrpipe',
                                'passwordchanged': {'EventID': 4738},
                                'passwordchanged_filter': {'PasswordLastSet': None},
                                'samrpipe': {'EventID': 5145,
                                             'RelativeTargetName': 'samr'},
                                'timeframe': '15s'},
                  'id': '7818b381-5eb1-4641-bea5-ef9e4cfb5951',
                  'level': 'medium',
                  'logsource': {'product': 'windows', 'service': 'security'},
                  'tags': ['attack.credential_access', 'attack.t1212'],
                  'title': 'Possible Remote Password Change Through SAMR'}},
 {'data_source': ['4624', 'Authentication logs']},
 {'data_source': ['4688', 'Process Execution']},
 {'data_source': ['1000', ' 1001', 'Windows Error Reporting']},
 {'data_source': ['4624', 'Authentication logs']},
 {'data_source': ['4688', 'Process Execution']},
 {'data_source': ['1000', ' 1001', 'Windows Error Reporting']}]
```

## Potential Queries

```json
[{'name': 'Yml',
  'product': 'https://raw.githubusercontent.com/12306Bro/Threathunting-book/master/{}',
  'query': 'Yml\n'
           'title: MS14-068-PYKEK\n'
           'description: windows server 2008 / windows 7\n'
           'references: '
           'https://www.blackhat.com/docs/us-15/materials/us-15-Metcalf-Red-Vs-Blue-Modern-Active-Directory-Attacks-Detection-And-Protection-wp.pdf\n'
           'tags: T1212\n'
           'status: experimental\n'
           'author: 12306Bro\n'
           'logsource:\n'
           '    product: windows\n'
           '    service: Security\n'
           'detection:\n'
           '    selection1:\n'
           '        EventID: 4624 # account login\n'
           "        Account Domain: '* *.' # New Registration> Account domain "
           '(under normal circumstances, account should be a domain ABC, when '
           'there KEKEO attack, the account domain ABC.COM)\n'
           '    selection2:\n'
           '        EventID: 4672 # administrator login\n'
           '        Account Domain: # accounts domain (under normal '
           'circumstances, account should be a domain ABC, when there KEKEO '
           'attack, the account field is empty)\n'
           '    selection3:\n'
           '        EventID: 4768 #Kerberos TGS request\n'
           "        Supplied Realm Name: '* *.' # Field names provided (under "
           'normal circumstances, provide the name of the field should be ABC, '
           'when there KEKEO attack, the field name has been provided for the '
           'ABC.COM)\n'
           '    timeframe: last 5s\n'
           '    condition: all of them\n'
           'level: medium'},
 {'name': 'Yml',
  'product': 'https://raw.githubusercontent.com/12306Bro/Threathunting-book/master/{}',
  'query': 'Yml\n'
           'title: MS14-068-PYKEK\n'
           'description: windows server 2008 / windows 7\n'
           'references: '
           'https://github.com/ThreatHuntingProject/ThreatHunting/blob/master/hunts/golden_ticket.md\n'
           'tags: T1212\n'
           'status: experimental\n'
           'author: 12306Bro\n'
           'logsource:\n'
           '    product: windows\n'
           '    service: Security\n'
           'detection:\n'
           '    selection1:\n'
           '        EventID: 4624 # account login\n'
           "        Account Domain: '* *.' # New Registration> Account domain "
           '(under normal circumstances, account should be a domain ABC, when '
           'there PYKEK attack, the account domain ABC.COM)\n'
           "        Account Name: '*' # new login> account name (different "
           'from the account security identification of this condition are '
           'complex to implement)\n'
           '    selection2:\n'
           '        EventID: 4672 # administrator login\n'
           "        Account Domain: '* *.' # Account field (under normal "
           'circumstances, should account field ABC, when present PYKEK attack '
           'domain account ABC.COM)\n'
           '    selection3:\n'
           '        EventID: 4768 #Kerberos TGS request\n'
           "        Supplied Realm Name: '* *.' # Field names provided (under "
           'normal circumstances, provide the name of the field should be ABC, '
           'when there PYKEK attack, the field name has been provided for the '
           'ABC.COM)\n'
           '    timeframe: last 5s\n'
           '    condition: all of them\n'
           'level: medium'}]
```

## Raw Dataset

```json

```

# Tactics


* [Credential Access](../tactics/Credential-Access.md)


# Mitigations


* [Exploitation for Credential Access Mitigation](../mitigations/Exploitation-for-Credential-Access-Mitigation.md)

* [Update Software](../mitigations/Update-Software.md)
    
* [Threat Intelligence Program](../mitigations/Threat-Intelligence-Program.md)
    
* [Exploit Protection](../mitigations/Exploit-Protection.md)
    
* [Application Isolation and Sandboxing](../mitigations/Application-Isolation-and-Sandboxing.md)
    

# Actors

None
